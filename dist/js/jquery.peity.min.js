// Peity jQuery plugin version 2.0.0
// (c) 2014 Ben Pickles
//
// http://benpickles.github.io/peity
//
// Released under MIT license.
(function(e,q,i){var n=function(a,b){var c=q.createElementNS("http://www.w3.org/2000/svg",a);e.each(b,function(a,b){c.setAttribute(a,b)});return c},s="createElementNS"in q&&n("svg",{}).createSVGRect,j=e.fn.peity=function(a,b){s&&this.each(function(){var c=e(this),d=c.data("peity");if(d)a&&(d.type=a),e.extend(d.opts,b);else{var f=j.defaults[a],g={};e.each(c.data(),function(a,b){a in f&&(g[a]=b)});var i=e.extend({},f,g,b),d=new r(c,a,i);c.change(function(){d.draw()}).data("peity",d)}d.draw()});return this},
r=function(a,b,c){this.$el=a;this.type=b;this.opts=c},l=r.prototype;l.draw=function(){j.graphers[this.type].call(this,this.opts)};l.fill=function(){var a=this.opts.fill,b=a;e.isFunction(b)||(b=function(b,d){return a[d%a.length]});return b};l.prepare=function(a,b){var c;this.svg?c=e(this.svg).empty():(this.svg=n("svg",{"class":"peity"}),this.$el.hide().after(this.svg),c=e(this.svg).data("peity",this));this.svg.setAttribute("height",b);this.svg.setAttribute("width",a);return c};l.values=function(){return e.map(this.$el.text().split(this.opts.delimiter),
function(a){return parseFloat(a)})};j.defaults={};j.graphers={};j.register=function(a,b,c){this.defaults[a]=b;this.graphers[a]=c};j.register("pie",{delimiter:null,diameter:16,fill:["#ff9900","#fff4dd","#ffc66e"]},function(a){if(!a.delimiter){var b=this.$el.text().match(/[^0-9\.]/);a.delimiter=b?b[0]:","}b=this.values();if("/"==a.delimiter)var c=b[0],b=[c,i.max(0,b[1]-c)];for(var d=0,c=b.length,f=0;d<c;d++)f+=b[d];for(var a=this.prepare(a.width||a.diameter,a.height||a.diameter),d=a.width(),g=a.height(),
a=d/2,g=g/2,o=i.min(a,g),e=i.PI,m=this.fill(),h=-e/2,d=0;d<c;d++){var j=b[d],k=j/f,p;if(0!=k){if(1==k)p=n("circle",{cx:a,cy:g,r:o});else{p=2*k*e;var k=h+p,l=o*i.cos(h)+a,h=o*i.sin(h)+g,q=o*i.cos(k)+a,r=o*i.sin(k)+g;p=n("path",{d:["M",a,g,"L",l,h,"A",o,o,0,p>e?1:0,1,q,r,"Z"].join(" ")});h=k}p.setAttribute("fill",m.call(this,j,d,b));this.svg.appendChild(p)}}});j.register("line",{delimiter:",",fill:"#c6d9fd",height:16,max:null,min:0,stroke:"#4d89f9",strokeWidth:1,width:32},function(a){var b=this.values();
1==b.length&&b.push(b[0]);for(var c=i.max.apply(i,b.concat([a.max])),d=i.min.apply(i,b.concat([a.min])),f=this.prepare(a.width,a.height),g=f.width(),f=f.height()-a.strokeWidth,e=g/(b.length-1),j=f/(c-d),m=f+d*j,c=[0,m],h=0;h<b.length;h++)c.push(h*e,f-j*(b[h]-d)+a.strokeWidth/2);c.push(g,m);b=n("polygon",{fill:a.fill,points:c.join(" ")});this.svg.appendChild(b);a.strokeWidth&&(a=n("polyline",{fill:"transparent",points:c.slice(2,c.length-2).join(" "),stroke:a.stroke,"stroke-width":a.strokeWidth,"stroke-linecap":"square"}),
this.svg.appendChild(a))});j.register("bar",{delimiter:",",fill:["#4D89F9"],gap:1,height:16,max:null,min:0,width:32},function(a){for(var b=this.values(),c=i.max.apply(i,b.concat([a.max])),d=i.min.apply(i,b.concat([a.min])),f=this.prepare(a.width,a.height),g=f.width(),f=f.height(),e=f/(c-d),a=a.gap,g=(g+a)/b.length,j=this.fill(),m=0;m<b.length;m++){var h=b[m],l=f-e*(h-d),k;if(0==h){if(k=1/(window.devicePixelRatio||1),0<=d||0<c)l-=k}else k=e*h;0>k&&(l+=k,k=-k);h=n("rect",{fill:j.call(this,h,m,b),x:m*
g,y:l,width:g-a,height:k});this.svg.appendChild(h)}})})(jQuery,document,Math);
