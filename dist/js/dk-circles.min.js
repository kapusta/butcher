/* dkCircles - https://github.com/kapusta/circles - copyright Daniel Kapusta - MIT-LICENSE */
/* Circles - https://github.com/lugolabs/circles - copyright Artan Sinani - MIT-LICENSE */
!function(){var a=window.Circles=function(a){var b=a.id;if(this._el=document.getElementById(b),null!==this._el){var c=Math.PI/180*270;this._radius=a.radius,this._percentage=a.percentage,this._text=a.text,this._number=a.number||this._percentage,this._strokeWidth=a.width||10,this._colors=a.colors||["#EEE","#F00"],this._interval=16,this._textWrpClass="circles-text-wrp",this._textClass="circles-text",this._numberClass="circles-number",this._confirmAnimation(a.duration),this._svgSize=2*this._radius,this._radiusAdjusted=this._radius-this._strokeWidth/2,this._start=-Math.PI/180*90,this._startPrecise=this._precise(this._start),this._circ=c-this._start,this._el.innerHTML=this._wrap(this._generateSvg()+this._generateText()),this._canAnimate&&this._animate()}};a.prototype={VERSION:"0.0.3",_confirmAnimation:function(a){if(null===a)return this._canAnimate=!1,void 0;a=a||500;var b=a/this._interval,c=this._percentage/b,d=this._number/b;this._percentage<=1+c?this._canAnimate=!1:(this._canAnimate=!0,this._pathFactor=c,this._numberFactor=d)},_animate:function(){var a=1,b=this,c=this._el.getElementsByTagName("path")[1],d=this._getNumberElement(),e=this._number%1===0,f=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setTimeout(a,b._interval)},g=function(){var h=b._pathFactor*a,i=b._pathFactor*(a+1),j=b._numberFactor*a,k=!0;e&&(j=Math.round(j)),i>b._percentage&&(h=b._percentage,j=b._number,k=!1),h>b._percentage||(c.setAttribute("d",b._calculatePath(h,!0)),d.innerHTML=b._calculateNumber(j),a++,k&&f(g))};f(g)},_getNumberElement:function(){for(var a=this._el.getElementsByTagName("span"),b=0,c=a.length;c>b;b++)if(a[b].className===this._numberClass)return a[b]},_wrap:function(a){return'<div class="circles-wrp" style="position:relative; display:inline-block;">'+a+"</div>"},_generateText:function(){var a='<div class="'+this._textWrpClass+'" style="position:absolute; top:0; left:0; text-align:center; width:100%; font-size:'+.7*this._radius+"px; height:"+this._svgSize+"px; line-height:"+this._svgSize+'px;">'+this._calculateNumber(this._canAnimate?0:this._number);return this._text&&(a+='<span class="'+this._textClass+'">'+this._text+"</span>"),a+="</div>"},_calculateNumber:function(a){var b=(a+"").split("."),c='<span class="'+this._numberClass+'">'+b[0];return b.length>1&&(c+='.<span style="font-size:.4em">'+b[1].substring(0,2)+"</span>"),c+"</span>"},_generateSvg:function(){return'<svg width="'+this._svgSize+'" height="'+this._svgSize+'">'+this._generatePath(100,!1,this._colors[0])+this._generatePath(this._canAnimate?1:this._percentage,!0,this._colors[1])+"</svg>"},_generatePath:function(a,b,c){return'<path fill="transparent" stroke="'+c+'" stroke-width="'+this._strokeWidth+'" d="'+this._calculatePath(a,b)+'"/>'},_calculatePath:function(a,b){var c=this._start+a/100*this._circ,d=this._precise(c);return this._arc(d,b)},_arc:function(a,b){var c=a-.001,d=a-this._startPrecise<Math.PI?0:1;return["M",this._radius+this._radiusAdjusted*Math.cos(this._startPrecise),this._radius+this._radiusAdjusted*Math.sin(this._startPrecise),"A",this._radiusAdjusted,this._radiusAdjusted,0,d,1,this._radius+this._radiusAdjusted*Math.cos(c),this._radius+this._radiusAdjusted*Math.sin(c),b?"":"Z"].join(" ")},_precise:function(a){return Math.round(1e3*a)/1e3}},a.create=function(b){return new a(b)}}(),function(a,b){"use strict";a.module("dkCircles",[]).directive("dkCircles",["$log",function(){return{restrict:"A",replace:!1,scope:{circPercentage:"@"},link:function(a,c,d){var e=function(){b.create({id:d.id,percentage:parseFloat(d.circPercentage).toFixed(2),radius:parseInt(d.circRadius,10)||50,width:parseInt(d.circWidth,10)||10,number:d.circNumber||parseFloat(d.circPercentage).toFixed(2),text:d.circText||null,colors:d.circColors?d.circColors.split(","):["#D3B6C6","#4B253A"],duration:parseInt(d.circDuration,10)||null})};a.circPercentage?e():a.$watch(function(){return a.circPercentage},function(a){a&&e()})}}}])}(window.angular,window.Circles,document);